<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ultimate Assistant V2</title>
    <style>
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --video-accent: #e83e8c;
            --bg: #f8f9fa;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .card { background: white; width: 100%; max-width: 600px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        
        h2 { color: #333; margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        
        /* рокро╛ро▓ро┐ройродрпН родрпЗро░рпНро╡рпБ (Gender Selection) */
        .options-panel { margin: 15px 0; padding: 15px; background: #f1f3f5; border-radius: 10px; display: flex; justify-content: center; gap: 20px; font-weight: bold; }
        .options-panel input { width: auto; margin-right: 5px; cursor: pointer; }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        button { padding: 12px; cursor: pointer; border: none; border-radius: 10px; color: white; font-weight: bold; transition: 0.3s; font-size: 14px; }
        
        .btn-ask { background-color: var(--primary); }
        .btn-translate { background-color: #28a745; }
        .btn-video { background-color: var(--video-accent); }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* ро╡рпАроЯро┐ропрпЛ рокроХрпБродро┐ */
        #video-container { display: none; margin-top: 25px; border-radius: 15px; overflow: hidden; border: 4px solid var(--video-accent); background: #000; position: relative; }
        video { width: 100%; display: block; }

        /* роЯро┐ро░рпИро╡рпН рокроЯрпНроЯройрпН */
        .drive-link { display: inline-block; margin-top: 15px; background: var(--secondary); color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; font-size: 14px; }
        
        /* рокродро┐ро▓рпН рокроХрпБродро┐ */
        #response-area { margin-top: 25px; text-align: left; }
        #response-box { background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; max-height: 250px; overflow-y: auto; white-space: pre-wrap; line-height: 1.6; color: #444; }
    </style>
</head>
<body>

<div class="card">
    <h2>ЁЯдЦ AI Video Assistant</h2>
    
    <input type="text" id="ngrokUrl" placeholder="Ngrok URL-роР роЗроЩрпНроХрпЗ рокрпЗро╕рпНроЯрпН роЪрпЖропрпНропро╡рпБроорпН (e.g. https://xxxx.ngrok.free.app)">
    
    <div class="options-panel">
        <span>Avatar: </span>
        <label><input type="radio" name="gender" value="male" checked> Male ЁЯСи</label>
        <label><input type="radio" name="gender" value="female"> Female ЁЯСй</label>
    </div>

    <textarea id="userInput" rows="4" placeholder="роЖроЩрпНроХро┐ро▓родрпНродро┐ро▓рпН роЕро▓рпНро▓родрпБ родрооро┐ро┤ро┐ро▓рпН роХрпЗро│рпНро╡ро┐ропрпИроХрпН роХрпЗроЯрпНроХро╡рпБроорпН..."></textarea>
    
    <div class="btn-group">
        <button class="btn-translate" onclick="callApi('translate')">Translate</button>
        <button class="btn-ask" onclick="callApi('ask')">Ask Chat</button>
        <button class="btn-video" onclick="callApi('ask_video')">Video Bot</button>
    </div>

    <a href="https://drive.google.com/drive/folders/1lZnsfRTV9BM3inNyXTAGxKJIcvN5inJO?usp=sharing" target="_blank" class="drive-link">
        ЁЯУВ View in Google Drive (Workaround)
    </a>

    <div id="video-container">
        <video id="aiVideo" controls playsinline poster="https://via.placeholder.com/600x400/000000/FFFFFF?text=Generating+Video..."></video>
    </div>

    <div id="response-area">
        <strong>рокродро┐ро▓рпН (Response):</strong>
        <div id="response-box">роХро╛родрпНродро┐ро░рпБроХрпНроХро┐ро▒родрпБ...</div>
    </div>
</div>

<script>
    async function callApi(mode) {
        const text = document.getElementById('userInput').value;
        const baseUrl = document.getElementById('ngrokUrl').value.replace(/\/$/, "");
        const responseBox = document.getElementById('response-box');
        const vContainer = document.getElementById('video-container');
        const vPlayer = document.getElementById('aiVideo');
        const gender = document.querySelector('input[name="gender"]:checked').value;

        if (!baseUrl || !text) {
            alert("URL рооро▒рпНро▒рпБроорпН роЙро░рпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН!");
            return;
        }

        responseBox.innerText = "Processing... родропро╡рпБроЪрпЖропрпНродрпБ роХро╛родрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН.";
        vContainer.style.display = "none";

        try {
            const response = await fetch(`${baseUrl}/${mode}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text, gender: gender })
            });

            const data = await response.json();
            responseBox.innerText = data.result || (data.error ? "Error: " + data.error : "No response");

            if (mode === 'ask_video' && data.video_url) {
                vContainer.style.display = "block";
                
                // рокро┐ро│ро╛роЩрпНроХрпН ро╡ро┐рогрпНроЯрпЛро╡рпИродрпН родро╡ро┐ро░рпНроХрпНроХ Blob Fetch роорпБро▒рпИ
                console.log("Fetching video blob from:", data.video_url);
                const videoRes = await fetch(data.video_url);
                const blob = await videoRes.blob();
                const blobUrl = URL.createObjectURL(blob);
                
                vPlayer.src = blobUrl;
                vPlayer.load();
                vPlayer.play().catch(e => {
                    console.log("Autoplay blocked, showing controls.");
                    vPlayer.controls = true;
                });
            }
        } catch (error) {
            responseBox.innerText = "роЪро░рпНро╡ро░рпН роХройрпЖроХрпНро╖ройрпН родрпЛро▓рпНро╡ро┐! Ngrok рооро▒рпНро▒рпБроорпН Colab Server-роРроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.";
        }
    }
</script>

</body>
</html>
